<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Terminal Monitor - å®æ—¶ç»ˆç«¯æŸ¥çœ‹å™¨</title>
    
    <!-- xterm.js ç»ˆç«¯æ¨¡æ‹Ÿå™¨ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }
        
        .status-indicator.disconnected {
            background: #ef4444;
            animation: none;
        }
        
        /* ä¼šè¯æ ‡ç­¾æ  */
        .session-tabs {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .tab.active {
            background: #007acc;
            border-color: #007acc;
            box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
        }
        
        .tab-icon {
            font-size: 14px;
        }
        
        .tab-close {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .tab-close:hover {
            opacity: 1;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }
        
        /* ç»ˆç«¯å®¹å™¨ */
        .terminal-wrapper {
            flex: 1;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
        }
        
        .terminal-header {
            background: #2d2d2d;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        
        .terminal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #888;
        }
        
        .terminal-controls {
            display: flex;
            gap: 8px;
        }
        
        .control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .control-btn:hover {
            opacity: 0.8;
        }
        
        .control-btn.close { background: #ff5f56; }
        .control-btn.minimize { background: #ffbd2e; }
        .control-btn.maximize { background: #27c93f; }
        
        #terminal {
            flex: 1;
            padding: 10px;
            padding-bottom: 30px;  /* å¢åŠ åº•éƒ¨å†…è¾¹è· */
            overflow-y: auto;      /* ç¡®ä¿å¯ä»¥æ»šåŠ¨ */
        }
        
        /* ä¾§è¾¹æ ä¿¡æ¯ */
        .sidebar {
            width: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            overflow-y: auto;
        }
        
        .info-section {
            margin-bottom: 20px;
        }
        
        .info-section h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }
        
        .info-label {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .info-value {
            color: #fff;
            font-weight: 500;
        }
        
        /* å‘½ä»¤å†å² */
        .command-history {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        
        .command-item {
            padding: 5px;
            margin: 2px 0;
            font-family: monospace;
            font-size: 12px;
            color: #4ade80;
            border-left: 2px solid #4ade80;
            padding-left: 10px;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  */
        .status-bar {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-left {
            display: flex;
            gap: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æç¤ºä¿¡æ¯ */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <h1>
            ğŸ–¥ï¸ AI Terminal Monitor
            <span class="status-indicator" id="connectionStatus"></span>
            <span style="font-size: 14px; font-weight: normal; margin-left: 10px;" id="connectionText">è¿æ¥ä¸­...</span>
        </h1>
    </div>
    
    <!-- ä¼šè¯æ ‡ç­¾ -->
    <div class="session-tabs" id="sessionTabs">
        <div class="tab" onclick="createNewSession()">
            <span class="tab-icon">â•</span>
            <span>ç­‰å¾…ç»ˆç«¯ä¼šè¯...</span>
        </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <!-- ç»ˆç«¯å®¹å™¨ -->
        <div class="terminal-wrapper">
            <div class="terminal-header">
                <div class="terminal-title">
                    <span id="terminalSession">æ— æ´»åŠ¨ä¼šè¯</span>
                    <span id="terminalPath" style="color: #666;">-</span>
                </div>
                <div class="terminal-controls">
                    <div class="control-btn close" title="å…³é—­"></div>
                    <div class="control-btn minimize" title="æœ€å°åŒ–"></div>
                    <div class="control-btn maximize" title="æœ€å¤§åŒ–"></div>
                </div>
            </div>
            <div id="terminal"></div>
        </div>
        
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- ä¼šè¯ä¿¡æ¯ -->
            <div class="info-section">
                <h3>ğŸ“Š ä¼šè¯ä¿¡æ¯</h3>
                <div class="info-item">
                    <span class="info-label">ä¼šè¯åç§°</span>
                    <span class="info-value" id="sessionName">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">å·¥ä½œç›®å½•</span>
                    <span class="info-value" id="workingDir">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Shellç±»å‹</span>
                    <span class="info-value" id="shellType">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">è¿è¡Œæ—¶é—´</span>
                    <span class="info-value" id="uptime">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ç¼“å†²åŒº</span>
                    <span class="info-value" id="bufferSize">0 KB</span>
                </div>
            </div>
            
            <!-- å‘½ä»¤å†å² -->
            <div class="info-section">
                <h3>ğŸ“ æœ€è¿‘å‘½ä»¤</h3>
                <div class="command-history" id="commandHistory">
                    <div style="color: #666; text-align: center;">æš‚æ— å‘½ä»¤</div>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="info-section">
                <h3>ğŸ“ˆ ç»Ÿè®¡</h3>
                <div class="info-item">
                    <span class="info-label">æ€»å‘½ä»¤æ•°</span>
                    <span class="info-value" id="commandCount">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">è¾“å‡ºè¡Œæ•°</span>
                    <span class="info-value" id="outputLines">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ´»åŠ¨ä¼šè¯</span>
                    <span class="info-value" id="activeCount">0</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
        <div class="status-left">
            <div class="status-item">
                <span>âš¡</span>
                <span id="latency">å»¶è¿Ÿ: 0ms</span>
            </div>
            <div class="status-item">
                <span>ğŸ“¡</span>
                <span id="dataRate">0 KB/s</span>
            </div>
            <div class="status-item">
                <span>ğŸ•</span>
                <span id="currentTime"></span>
            </div>
        </div>
        <div class="status-right">
            <span style="opacity: 0.6;">AI Agent Terminal Monitor v1.0</span>
        </div>
    </div>
    
    <!-- æç¤ºæ¡† -->
    <div class="tooltip" id="tooltip"></div>
    
    <!-- å¼•å…¥ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let term = null;
        let fitAddon = null;
        let socket = null;
        let currentSession = null;
        let sessions = {};
        let commandHistory = [];
        let stats = {
            commandCount: 0,
            outputLines: 0,
            dataReceived: 0,
            startTime: Date.now()
        };
        
        // åˆå§‹åŒ–ç»ˆç«¯
        function initTerminal() {
            term = new Terminal({
                cursorBlink: true,
                fontSize: 14,
                fontFamily: 'Consolas, Monaco, "Courier New", monospace',
                theme: {
                    background: '#1e1e1e',
                    foreground: '#d4d4d4',
                    cursor: '#aeafad',
                    black: '#000000',
                    red: '#cd3131',
                    green: '#0dbc79',
                    yellow: '#e5e510',
                    blue: '#2472c8',
                    magenta: '#bc3fbc',
                    cyan: '#11a8cd',
                    white: '#e5e5e5'
                },
                scrollback: 10000,
                cols: 120,  // è®¾ç½®å›ºå®šåˆ—æ•°
                rows: 30,   // è®¾ç½®å›ºå®šè¡Œæ•°
                convertEol: true,  // è½¬æ¢è¡Œå°¾
                wordSeparator: ' ()[]{}\'"',  // å•è¯åˆ†éš”ç¬¦
                rendererType: 'canvas',  // ä½¿ç”¨canvasæ¸²æŸ“å™¨
                allowTransparency: false
            });
            
            // æ·»åŠ æ’ä»¶
            fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);
            
            const webLinksAddon = new WebLinksAddon.WebLinksAddon();
            term.loadAddon(webLinksAddon);
            
            // æ‰“å¼€ç»ˆç«¯
            term.open(document.getElementById('terminal'));
            
            // å»¶è¿Ÿæ‰§è¡Œfitä»¥ç¡®ä¿æ­£ç¡®è®¡ç®—å°ºå¯¸
            setTimeout(() => {
                fitAddon.fit();
                console.log(`ç»ˆç«¯å°ºå¯¸: ${term.cols}x${term.rows}`);
            }, 100);
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            term.writeln('\x1b[1;36mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\x1b[0m');
            term.writeln('\x1b[1;36mâ•‘     ğŸ¤– AI Terminal Monitor v1.0       â•‘\x1b[0m');
            term.writeln('\x1b[1;36mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m');
            term.writeln('');
            term.writeln('\x1b[33mæ­£åœ¨è¿æ¥åˆ°AI Agent...\x1b[0m');
            term.writeln('');
        }
        
        // åˆå§‹åŒ–WebSocketè¿æ¥
        function initWebSocket() {
            socket = io();
            
            // è¿æ¥æˆåŠŸ
            socket.on('connect', () => {
                console.log('WebSocketè¿æ¥æˆåŠŸ');
                updateConnectionStatus(true);
                term.writeln('\x1b[32mâœ“ å·²è¿æ¥åˆ°æœåŠ¡å™¨\x1b[0m');
                
                // è®¢é˜…æ‰€æœ‰ç»ˆç«¯äº‹ä»¶
                socket.emit('terminal_subscribe', { all: true });
                console.log('å·²å‘é€ç»ˆç«¯è®¢é˜…è¯·æ±‚');
            });
            
            // è¿æ¥æ–­å¼€
            socket.on('disconnect', () => {
                console.log('WebSocketè¿æ¥æ–­å¼€');
                updateConnectionStatus(false);
                term.writeln('\x1b[31mâœ— ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥\x1b[0m');
            });
            
            // è®¢é˜…æˆåŠŸç¡®è®¤
            socket.on('terminal_subscribed', (data) => {
                console.log('ç»ˆç«¯è®¢é˜…æˆåŠŸ:', data);
                term.writeln('\x1b[32mâœ“ å·²è®¢é˜…ç»ˆç«¯äº‹ä»¶\x1b[0m');
            });
            
            // ç»ˆç«¯å¯åŠ¨äº‹ä»¶
            socket.on('terminal_started', (data) => {
                console.log('ç»ˆç«¯å¯åŠ¨:', data);
                addSession(data.session, data);
                term.writeln(`\x1b[32m[ç»ˆç«¯å¯åŠ¨]\x1b[0m ${data.session} - ${data.working_dir}`);
            });
            
            // ç»ˆç«¯åˆ—è¡¨æ›´æ–°
            socket.on('terminal_list_update', (data) => {
                console.log('ç»ˆç«¯åˆ—è¡¨æ›´æ–°:', data);
                if (data.terminals && data.terminals.length > 0) {
                    // æ¸…é™¤æ‰€æœ‰ä¼šè¯å¹¶é‡æ–°æ·»åŠ 
                    sessions = {};
                    for (const terminal of data.terminals) {
                        sessions[terminal.name] = {
                            working_dir: terminal.working_dir,
                            is_running: terminal.is_running,
                            shell: 'bash'
                        };
                    }
                    updateSessionTabs();
                    if (data.active && !currentSession) {
                        switchToSession(data.active);
                    }
                }
            });
            
            // ç»ˆç«¯è¾“å‡ºäº‹ä»¶
            socket.on('terminal_output', (data) => {
                console.log('æ”¶åˆ°ç»ˆç«¯è¾“å‡º:', data.session, data.data.length + 'å­—èŠ‚');
                if (data.session === currentSession || !currentSession) {
                    // å¦‚æœæ²¡æœ‰å½“å‰ä¼šè¯ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°è¿™ä¸ªä¼šè¯
                    if (!currentSession && data.session) {
                        if (!sessions[data.session]) {
                            addSession(data.session, {
                                session: data.session,
                                working_dir: 'unknown'
                            });
                        }
                        switchToSession(data.session);
                    }
                    // ç›´æ¥å†™å…¥åŸå§‹è¾“å‡º
                    term.write(data.data);
                    stats.outputLines++;
                    stats.dataReceived += data.data.length;
                    updateStats();
                }
            });
            
            // ç»ˆç«¯è¾“å…¥äº‹ä»¶ï¼ˆAIå‘é€çš„å‘½ä»¤ï¼‰
            socket.on('terminal_input', (data) => {
                console.log('æ”¶åˆ°ç»ˆç«¯è¾“å…¥:', data.session, data.data);
                if (data.session === currentSession || !currentSession) {
                    // å¦‚æœæ²¡æœ‰å½“å‰ä¼šè¯ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°è¿™ä¸ªä¼šè¯
                    if (!currentSession && data.session) {
                        if (!sessions[data.session]) {
                            addSession(data.session, {
                                session: data.session,
                                working_dir: 'unknown'
                            });
                        }
                        switchToSession(data.session);
                    }
                    // ç”¨ç»¿è‰²æ˜¾ç¤ºè¾“å…¥çš„å‘½ä»¤
                    term.write(`\x1b[1;32mâœ ${data.data}\x1b[0m`);
                    
                    // æ·»åŠ åˆ°å‘½ä»¤å†å²
                    addCommandToHistory(data.data.trim());
                    stats.commandCount++;
                    updateStats();
                }
            });
            
            // ç»ˆç«¯å…³é—­äº‹ä»¶
            socket.on('terminal_closed', (data) => {
                console.log('ç»ˆç«¯å…³é—­:', data);
                removeSession(data.session);
                term.writeln(`\x1b[31m[ç»ˆç«¯å…³é—­]\x1b[0m ${data.session}`);
            });
            
            // ç»ˆç«¯åˆ‡æ¢äº‹ä»¶
            socket.on('terminal_switched', (data) => {
                console.log('ç»ˆç«¯åˆ‡æ¢:', data);
                switchToSession(data.current);
            });
            
            // è°ƒè¯•ï¼šç›‘å¬æ‰€æœ‰äº‹ä»¶
            const onevent = socket.onevent;
            socket.onevent = function (packet) {
                const args = packet.data || [];
                console.log('Socketäº‹ä»¶:', args[0], args[1]);
                onevent.call(this, packet);
            };
        }
        
        // æ·»åŠ ä¼šè¯
        function addSession(name, info) {
            sessions[name] = info;
            updateSessionTabs();
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªä¼šè¯ï¼Œè‡ªåŠ¨åˆ‡æ¢
            if (!currentSession) {
                switchToSession(name);
            }
        }
        
        // ç§»é™¤ä¼šè¯
        function removeSession(name) {
            delete sessions[name];
            updateSessionTabs();
            
            // å¦‚æœæ˜¯å½“å‰ä¼šè¯ï¼Œåˆ‡æ¢åˆ°å…¶ä»–ä¼šè¯
            if (currentSession === name) {
                const remaining = Object.keys(sessions);
                if (remaining.length > 0) {
                    switchToSession(remaining[0]);
                } else {
                    currentSession = null;
                    updateSessionInfo();
                }
            }
        }
        
        // åˆ‡æ¢ä¼šè¯
        function switchToSession(name) {
            currentSession = name;
            updateSessionTabs();
            updateSessionInfo();
            
            // æ¸…ç©ºç»ˆç«¯å¹¶æ˜¾ç¤ºåˆ‡æ¢ä¿¡æ¯
            term.clear();
            term.writeln(`\x1b[36m[åˆ‡æ¢åˆ°ç»ˆç«¯: ${name}]\x1b[0m`);
            term.writeln('');
            
            // è¯·æ±‚è¯¥ä¼šè¯çš„å†å²è¾“å‡º
            socket.emit('get_terminal_output', { session: name });
        }
        
        // æ›´æ–°ä¼šè¯æ ‡ç­¾
        function updateSessionTabs() {
            const container = document.getElementById('sessionTabs');
            container.innerHTML = '';
            
            if (Object.keys(sessions).length === 0) {
                container.innerHTML = `
                    <div class="tab">
                        <span class="tab-icon">â³</span>
                        <span>ç­‰å¾…ç»ˆç«¯ä¼šè¯...</span>
                    </div>
                `;
                return;
            }
            
            for (const [name, info] of Object.entries(sessions)) {
                const tab = document.createElement('div');
                tab.className = `tab ${name === currentSession ? 'active' : ''}`;
                tab.innerHTML = `
                    <span class="tab-icon">ğŸ“Ÿ</span>
                    <span>${name}</span>
                `;
                tab.onclick = () => switchToSession(name);
                container.appendChild(tab);
            }
        }
        
        // æ›´æ–°ä¼šè¯ä¿¡æ¯
        function updateSessionInfo() {
            if (!currentSession || !sessions[currentSession]) {
                document.getElementById('sessionName').textContent = '-';
                document.getElementById('workingDir').textContent = '-';
                document.getElementById('shellType').textContent = '-';
                document.getElementById('terminalSession').textContent = 'æ— æ´»åŠ¨ä¼šè¯';
                document.getElementById('terminalPath').textContent = '-';
                return;
            }
            
            const info = sessions[currentSession];
            document.getElementById('sessionName').textContent = currentSession;
            document.getElementById('workingDir').textContent = info.working_dir || '-';
            document.getElementById('shellType').textContent = info.shell || '-';
            document.getElementById('terminalSession').textContent = currentSession;
            document.getElementById('terminalPath').textContent = info.working_dir || '-';
        }
        
        // æ·»åŠ å‘½ä»¤åˆ°å†å²
        function addCommandToHistory(command) {
            commandHistory.unshift(command);
            if (commandHistory.length > 20) {
                commandHistory.pop();
            }
            updateCommandHistory();
        }
        
        // æ›´æ–°å‘½ä»¤å†å²æ˜¾ç¤º
        function updateCommandHistory() {
            const container = document.getElementById('commandHistory');
            if (commandHistory.length === 0) {
                container.innerHTML = '<div style="color: #666; text-align: center;">æš‚æ— å‘½ä»¤</div>';
                return;
            }
            
            container.innerHTML = commandHistory
                .map(cmd => `<div class="command-item">${cmd}</div>`)
                .join('');
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('commandCount').textContent = stats.commandCount;
            document.getElementById('outputLines').textContent = stats.outputLines;
            document.getElementById('activeCount').textContent = Object.keys(sessions).length;
            document.getElementById('bufferSize').textContent = (stats.dataReceived / 1024).toFixed(1) + ' KB';
            
            // æ›´æ–°è¿è¡Œæ—¶é—´
            const uptime = Math.floor((Date.now() - stats.startTime) / 1000);
            const hours = Math.floor(uptime / 3600);
            const minutes = Math.floor((uptime % 3600) / 60);
            const seconds = uptime % 60;
            document.getElementById('uptime').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            if (connected) {
                indicator.classList.remove('disconnected');
                text.textContent = 'å·²è¿æ¥';
                text.style.color = '#4ade80';
            } else {
                indicator.classList.add('disconnected');
                text.textContent = 'æœªè¿æ¥';
                text.style.color = '#ef4444';
            }
        }
        
        // æ›´æ–°å½“å‰æ—¶é—´
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('zh-CN');
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            if (fitAddon) {
                fitAddon.fit();
            }
        });
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initTerminal();
            initWebSocket();
            
            // å®šæ—¶æ›´æ–°
            setInterval(updateCurrentTime, 1000);
            setInterval(updateStats, 1000);
            updateCurrentTime();
        });
    </script>
</body>
</html>